{
    "contents" : "#To quote wikipedia ... \n\n# \"The first voyage of James Cook was a combined Royal Navy and Royal Society expedition to the \n# south Pacific Ocean aboard HMS Endeavour, from 1768 to 1771. It was the first of three Pacific \n# voyages of which Cook was the commander. The aims of this first expedition were to observe the \n# 1769 transit of Venus across the Sun (3â€“4 June of that year), and to seek evidence of the \n# postulated Terra Australis Incognita or unknown southern land\"\n\n# This script plots the Endeavor's voyage around the world. I've cut the script short and limited \n# it from England to Cape Horn due to the full script taking too long. The full thing can be run \n# by changing the limit of the while loop.  \n\n# The Earth's movement initially followed the ship exactly, but the movement was very jittery. \n# Therefore, the ship's movement is instead fitted with a smoothed spline, and the Earth's movement \n# follows that instead. The ship's movement is as given in the original dataset.  \n\n# I had no idea how to plot a 3D map when I started. The following websites were invaluble,\n\n# http://robinlovelace.net/2014/06/22/great-circles-in-rworldmap-ggplot2.html\n# http://docs.ggplot2.org/0.9.3.1/map_data.html\n\n\n\n#data = read.csv(\"../input/CLIWOC15.csv\", header = T) #Load the data\n\n#Load data,\ndata = read.csv(\"data\\\\CLIWOC15.csv\", header = T) #Load the data\n\n#Load libraries,\nlibrary(ggplot2)\nrequire(animation)\n\nEndeavour = data[grep(\"Endeavour\", data$ShipName),] #Create an Endeavour only version\nrm(data) #Remove the starting data\n\nexc = (is.na(Endeavour$Lat3) | is.na(Endeavour$Lon3) | is.na(Endeavour$Distance)) #Delete rows with missing long, lat or distance\nEndeavour = Endeavour[!exc,]\n\nEndeavour = Endeavour[with(Endeavour, order(UTC)),] #Order by date\n\n#Load the map data,\ns <- map_data(\"world\")\n\n#Set everywhere to green,\ns$colour = \"green\"\n\n#Change a few obvious ones,\ns$colour[s$region == \"Antarctica\"] = \"white\"\ns$colour[s$region == \"Greenland\"] = \"white\"\ns$colour[s$region == \"Morocco\"] = \"orange\"\ns$colour[s$region == \"Algeria\"] = \"orange\"\ns$colour[s$region == \"Tunisia\"] = \"orange\"\ns$colour[s$region == \"Libya\"] = \"orange\"\ns$colour[s$region == \"Egypt\"] = \"orange\"\ns$colour[s$region == \"Saudi Arabia\"] = \"orange\"\ns$colour[s$region == \"Australia\"] = \"orange\"\ns$colour[s$region == \"Mongolia\"] = \"orange\"\n\n#Set a weather column,\nEndeavour$Col = \"white\"\nEndeavour$Col[grep(\"rain|showers\", Endeavour$PrecipitationDescriptor)] = 'blue'\nEndeavour$Col[grep(\"fine|pleasant|fair|clear\", Endeavour$Clearness)] = 'light blue'\nEndeavour$Col[grep(\"cloudy|hazy\", Endeavour$Clearness)] = 'grey'\n\n#Work out the total distance,\nEndeavour$Total_Distance = cumsum(Endeavour$Distance)\n\n#Fit a spline to the coordiates to make the Earth's movement a little less jittery,\nss = smooth.spline(Endeavour$Lon3, Endeavour$Lat3)\n\n#Rearrange to get the starting point to the UK. Add a few points as the spline has fewer than the starting coordiates,\nssc = as.data.frame(cbind(ss$x, ss$y))\nss1 = ssc[1:255,]\nss2 = ssc[256:334,]\nss_add = rbind(ss1[255,],ss1[255,],ss1[255,],ss1[255,],ss1[255,],ss1[255,],ss1[255,])\nss_new = rbind(ss_add, ss_add, ss1[255,],ss2, ss1)\n\n#Quick check of the starting and new coordinates,\n#Note, this spline is for the movement of the Earth, NOT the position of the ship,\nplot(Endeavour$Lon3, Endeavour$Lat3, col = \"red\")\npoints(ss_new)\n\n#Set a counter,\ni = 1\n\n#Loop through the rows and save the gif...\nsaveGIF(while (i < 100){\n\n    #Set the viewing position from the spline,        \n    orient_x = ss_new$V2[349-i]\n    orient_y = ss_new$V1[349-i]\n        \n    #Let's plot this beast!\n    print(m <- ggplot(s, aes(x=long, y=lat, group=group)) + #Set ggplot2\n              \n        geom_path(data = s, aes(x=long, y=lat, group=group), colour=\"black\") + #Plot the Earth\n            \n        geom_polygon(fill=s$colour, colour=\"black\") + #Colour the countries\n            \n        theme(panel.grid.major = element_line(colour = \"black\")) + #Make the grid-lines black\n            \n        coord_map(\"ortho\", orientation=c(orient_x,orient_y,0)) + #Set the viewing position\n            \n        geom_point(size = Endeavour$Total_Distance[i]/500, colour = 'black', fill = Endeavour$Col[i], \n            aes(x = Endeavour$Lon3[i], y = Endeavour$Lat3[i], pch = 21)) #Plot the Endeavour's position\n        \n        + scale_shape_identity() #Need this to allow the size and colour to come from their respective variables\n    \n        + annotate(\"text\", x = Endeavour$Lon3[i]-22, y = Endeavour$Lat3[i], #Add the date\n            label = paste(Endeavour$Day[i],\"/\",Endeavour$Month[i],\"/\",Endeavour$Year[i])\n            ,size = 5, colour = \"red\", fontface=\"bold\")\n        \n        + ggtitle(expression(atop(\"The First Voyage of James Cook - UK to Cape Horn\", #Add the title and subtitle\n            atop(italic(\"Spot size = Distance (arb). Colour = Day's weather\"), \"\")))))\n        \n    i = i+1\n        \n}, movie.name = \"Endeavour3D.gif\", interval = 0.2, convert = \"convert\", ani.width = 800, \nani.height = 800)",
    "created" : 1453972263741.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2134392944",
    "id" : "38D7D648",
    "lastKnownWriteTime" : 1454082817,
    "path" : "C:/Users/rob.harrand/Desktop/WORK/Kaggle/ShipsLogs/ShipsLogs3D.R",
    "project_path" : "ShipsLogs3D.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}