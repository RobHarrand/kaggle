{
    "collab_server" : "",
    "contents" : "library('ggplot2')\nlibrary('animation')\nlibrary(geosphere)\n\nbat1 = 'pair23_indA'\nbat2 = 'pair23_indB'\n\ndt = read.csv(\"Movement coordination in trawling bats (data from Giuggioli et al. 2015).csv\")\n\ndt_sub = dt[dt$tag.local.identifier ==  bat1| dt$tag.local.identifier == bat2,]\n\ndt_sub = dt_sub[order(dt_sub$timestamp),]\ndt_sub$timestamp = as.POSIXct(dt_sub$timestamp, format = )\n\nmin_lat <- min(dt_sub$location.lat)\nmax_lat <- max(dt_sub$location.lat)\nmin_long <- min(dt_sub$location.long)\nmax_long <- max(dt_sub$location.long)\n\nl = length(dt_sub$event.id)\n#i = 1\n\n# saveGIF(while (i <= l) {\n#   \n#   print(m <- ggplot(data=dt_sub[1:i,],aes(location.long[1:i],location.lat[1:i])) + \n#           geom_point(size=2, color=I(dt_sub$tag.local.identifier[1:i]), alpha = 1) +\n#           scale_x_continuous(limits=c(min_long, max_long)) +\n#           scale_y_continuous(limits=c(min_lat, max_lat)) +\n#           theme(panel.background = element_rect(fill = \"white\"),\n#                 panel.grid.major = element_blank(),\n#                 panel.grid.minor = element_blank()) +\n#           annotate(\"text\", x =-2.66310, y=51.40704, label = dt_sub$timestamp[i], colour = 'black', size = 8))\n#   \n#   i = i+1\n#   \n# }, movie.name = \"bats.gif\", interval = 0.1, convert = \"convert\", ani.width = 800, \n# ani.height = 800)\n\n\ndt_sub$grp = 1\n\ndt_sub$grp[dt_sub$individual.local.identifier == bat1] = seq(1:length(dt_sub$event.id[dt_sub$individual.local.identifier == bat1]))\ndt_sub$grp[dt_sub$individual.local.identifier == bat2] = seq(1:length(dt_sub$event.id[dt_sub$individual.local.identifier == bat2]))\n\ndt_sub$Col = 'red'\ndt_sub$Col[dt_sub$individual.local.identifier == bat2] = 'blue'\n\n\n\n\ni=1\nd_temp = vector()\n\nwhile (i <= (length(dt_sub$grp)/2)) {\n\n  d_temp[i] = distm(c(dt_sub$location.long[dt_sub$individual.local.identifier == bat1 & dt_sub$grp == i],\n           dt_sub$location.lat[dt_sub$individual.local.identifier == bat1 & dt_sub$grp == i]),\n         c(dt_sub$location.long[dt_sub$individual.local.identifier == bat2 & dt_sub$grp == i],\n           dt_sub$location.lat[dt_sub$individual.local.identifier == bat2 & dt_sub$grp == i]), \n         fun = distHaversine)\n \n  i=i+1\n   \n}\n\nd = d_temp\nd2 = vector()\n\na=1\nb=1\n\nwhile (a<=length(d)*2) {\n\n  d2[a] = d[b]\n  a=a+1\n  d2[a] = d[b]\n  a=a+1\n  b=b+1\n    \n}\n\nrange01 <- function(x){(d2-min(d2))/(max(d2)-min(d2))}\nd_range = range01(d2)\n\nx_pos = min_long + (max_long - min_long)*0.2\ny_pos = min_lat + (max_lat - min_lat)*0.1\n\ni=1\n\nsaveGIF(while (i <= l) {\n  \n  time = dt_sub$timestamp[i]\n  time = as.character(time)\n  time = strsplit(time, \"GMT\")[[1]][1]\n  time = strsplit(time, \":\")[[1]][3]\n  time = paste(\"Time: \", time, \"s\", sep = \"\")\n  distance = paste(\"Distance between bats: \", round(d2[i],2), \"m\", sep = \"\")\n  \n  print(m <- ggplot(data=dt_sub[1:i,],aes(location.long[1:i],location.lat[1:i], group = grp)) + \n          geom_point(size=2, color=I(dt_sub$Col[1:i]), alpha = 1) +\n          scale_x_continuous(limits=c(min_long, max_long)) +\n          scale_y_continuous(limits=c(min_lat, max_lat)) +\n          geom_line(col = 'black', alpha = 1-d_range[1:i]) + \n          theme(panel.background = element_rect(fill = \"white\"),\n                panel.grid.major = element_blank(),\n                panel.grid.minor = element_blank()) +\n          annotate(\"text\", x =-2.66313, y=51.40694, label = \"Flight of Pair 23\", colour = 'black', size = 8) +\n          annotate(\"text\", x =x_pos, y=y_pos, label = time, colour = 'black', size = 6) +\n          annotate(\"text\", x =x_pos, y=y_pos-0.000004, label = distance, colour = 'black', size = 6))\n  \n  i = i+2\n  \n}, movie.name = \"bats.gif\", interval = 0.05, convert = \"convert\", ani.width = 800, \nani.height = 800)\n\n\n",
    "created" : 1503502134531.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2887854755",
    "id" : "52121C97",
    "lastKnownWriteTime" : 1503579431,
    "last_content_update" : 1503579431927,
    "path" : "C:/Users/rob.harrand/Desktop/WORK/Data hobbies/Kaggle/My data submissions/Bats/Bats.R",
    "project_path" : "Bats.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}