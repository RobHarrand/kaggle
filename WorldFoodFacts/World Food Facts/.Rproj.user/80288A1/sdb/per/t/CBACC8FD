{
    "contents" : "#LOAD LIBRARIES AND DATA\n########################\n\nlibrary(ggplot2)\nFoodFacts = read.csv(\"data\\\\FoodFacts.csv\", header = TRUE) #Load the CSV file\n\n\n#CLEAN UP THE DATA\n##################\n\n#Find the products in the catagory 'meat' and the product labelled 'vegan',\nmeat = grep(\"meat|Meat\", FoodFacts$categories_en)\nvegan = grep(\"vegan|Vegan\", FoodFacts$labels)\n\n#Create a new dataframe for countries vs number of products\nCountries = as.data.frame(table(FoodFacts$countries_en))\nCountries = Countries[-1,] #Remove the first, empty row\n\n#What are the countries with the highest levels?\nTop = head(Countries[order(-Countries$Freq),],10)\nTop = droplevels(Top)\n\n#However, these country names appears in many more rows as part of combined lists of countries.\n#We need to add these values to the individual countries.\n\n#The following while loop does the following,\n# - Picks out all the rows where each coountry name appears,\n# - Adds up all the totals for these countries,\n# - Updates the total in the original table with the new, larger number,\n\ni = 1\n\nwhile (i < length(Top$Var1)+1) {\n    \n    Country = grep(Top[i,1], Countries$Var1)\n    Country_totals = sum(Countries$Freq[Country])\n    Top[i,2] = Country_totals\n    i=i+1\n}\n\n#Quick check of the number of products per country,\nbarplot(Top$Freq, names.arg = Top$Var1, col = \"grey\", main = \"Number of Products by Country\"\n        , ylab = \"Counts\", las=1)\n\n#Create a new dataframe for countries vs number of meat products\nCountries_meat = as.data.frame(table(FoodFacts$countries_en[meat]))\nCountries_meat = Countries_meat[-1,] #Remove the first, empty row\n\n#What are the countries with the highest meat products?\nTop_meat = head(Countries_meat[order(-Countries_meat$Freq),],10)\nTop_meat = Top_meat[-grep(\",\", Top_meat$Var1),] #Get rid of any rows that are a combination of countries by looking for a comma\nTop_meat = droplevels(Top_meat)\n\n#Again, all the cases from the combined countries need adding to the totals,\n\ni = 1\n\nwhile (i < length(Top_meat$Var1)+1) {\n \n    Country = grep(Top[i,1], Countries_meat$Var1)\n    Country_totals = sum(Countries_meat$Freq[Country])\n    Top_meat[i,2] = Country_totals\n    i=i+1\n}\n\n\n#Create a new dataframe for countries vs number of vegan-labelled products\nCountries_vegan = as.data.frame(table(FoodFacts$countries_en[vegan]))\nCountries_vegan = Countries_vegan[-1,] #Remove the first, empty row\n\n#What are the countries with the highest vegan products?\nTop_vegan = head(Countries_vegan[order(-Countries_vegan$Freq),],10)\nTop_vegan = Top_vegan[-grep(\",\", Top_vegan$Var1),] #Get rid of any rows that are a combination of countries by looking for a comma\nTop_vegan = droplevels(Top_vegan)\n\n#Again, all the cases from the combined countries need adding to the totals,\n\ni = 1\n\nwhile (i < length(Top_vegan$Var1)+1) {\n    \n    Country = grep(Top_vegan[i,1], Countries_vegan$Var1)\n    Country_totals = sum(Countries_vegan$Freq[Country])\n    Top_vegan[i,2] = Country_totals\n    i=i+1\n}\n\n#Remove the starting data to save memory,\nrm(FoodFacts)\n\n#Change column names,\ncolnames(Top) = c(\"Country\", \"Count\")\ncolnames(Top_meat) = c(\"Country\", \"Count\")\ncolnames(Top_vegan) = c(\"Country\", \"Count\")\n\n#Do some merging to get overall results,\nResults_meat = merge(Top, Top_meat, by = \"Country\")\nResults_vegan = merge(Top, Top_vegan, by = \"Country\")\ncolnames(Results_meat) = c(\"Country\", \"Total no. of products\", \"No. of meat products\")\ncolnames(Results_vegan) = c(\"Country\", \"Total no. of products\", \"No. of vegan products\")\n\n#Work out how many meat and vegan products there are for each country as a % of total number in the dataset,\nResults_meat$MeatPerc = Results_meat$`No. of meat products` / Results_meat$`Total no. of products` * 100\nResults_vegan$VeganPerc = Results_vegan$`No. of vegan products` / Results_vegan$`Total no. of products` * 100\n\n\n\n#MAKE SOME PLOTS\n################\n\n#Have a look at the countries with the highest % of meat products (in terms of number of products in the dataset),\nm = ggplot(Results_meat, aes(x=reorder(Country,-MeatPerc), y=MeatPerc))\n\nm + geom_bar(stat = \"identity\", fill=\"pink\", colour=\"black\") +\n    ggtitle(\"Counties with Highest % of Meat Products \\n (in terms of no. of products submitted)\") +\n    ylab(\"Percentage %\") +\n    theme_classic() +\n    theme(legend.position=\"none\") +\n    theme(axis.text.x = element_text(size=15, angle = 90)) +\n    scale_x_discrete(name=\"\")\n\n#Have a look at the countries with the highest % of vegan-labelled products (in terms of number of products in the dataset),\nv = ggplot(Results_vegan, aes(x=reorder(Country,-VeganPerc), y=VeganPerc))\n\nv + geom_bar(stat = \"identity\", fill=\"dark green\", colour=\"black\") +\n    ggtitle(\"Counties with Highest % of Vegan-labelled Products \\n (in terms of no. of products submitted)\") +\n    ylab(\"Percentage %\") +\n    theme_classic() +\n    theme(legend.position=\"none\") +\n    theme(axis.text.x = element_text(size=15, angle = 90)) +\n    scale_x_discrete(name=\"\")\n\n#Note - This makes Spain look obsessed with vegan products. However, it seems to be more of a labelling convention. \n#The Spanish seem to label even the most obviously vegan products as vegan, such as tomatoes!\n\n#What does it look like if we remove Spain?\nResults_vegan = Results_vegan[-grep(\"Spain\", Results_vegan$Country),]\n\n#Have a look at the countries with the highest % of vegan-labelled products (in terms of number of products in the dataset),\n#with Spain removed,\nv = ggplot(Results_vegan, aes(x=reorder(Country,-VeganPerc), y=VeganPerc))\n\nv + geom_bar(stat = \"identity\", fill=\"green\", colour=\"black\") +\n    ggtitle(\"Counties with Highest % of Vegan-labelled Products \\n (in terms of no. of products submitted)\") +\n    ylab(\"Percentage %\") +\n    theme_classic() +\n    theme(legend.position=\"none\") +\n    theme(axis.text.x = element_text(size=15, angle = 90)) +\n    scale_x_discrete(name=\"\")\n\n###########################",
    "created" : 1453368923699.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3389833539",
    "id" : "CBACC8FD",
    "lastKnownWriteTime" : 1453464030,
    "path" : "C:/Users/rob.harrand/Desktop/WORK/Kaggle/WorldFoodFacts/World Food Facts/WorldFoodFacts.R",
    "project_path" : "WorldFoodFacts.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}